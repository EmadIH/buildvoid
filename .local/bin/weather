#!/bin/bash

# ุฅุนุฏุงุฏุงุช
API_KEY="e15811acfdd84fc0a15190002252101"
CITY="24.470901,39.612236"
UNIT="metric" # ูููุญุฏุงุช ุงููุชุฑูุฉ (ุฏุฑุฌุฉ ูุฆููุฉ)

# ุงูุชุญูู ูู ูุฌูุฏ ููู ุงูุชุฎุฒูู ุงููุคูุช
if [ -f "$CACHE_FILE" ]; then
  # ุงูุชุญูู ูู ุนูุฑ ุงูุชุฎุฒูู ุงููุคูุช
  last_update=$(stat -c %Y "$CACHE_FILE")
  current_time=$(date +%s)
  if (( current_time - last_update < CACHE_EXPIRATION )); then
    # ุฅุฐุง ูุงู ุงูููู ูุง ูุฒุงู ุตุงูุญูุงุ ูุฑุงุกุฉ ุงูุจูุงูุงุช ููู
    cat "$CACHE_FILE"
    exit 0
  fi
fi

# ุฅุฐุง ูู ููู ุงูููู ููุฌูุฏูุง ุฃู ุงูุชูุช ุตูุงุญูุชูุ ุฌูุจ ุงูุจูุงูุงุช ูู API
response=$(curl -s "http://api.weatherapi.com/v1/current.json?key=$API_KEY&q=$CITY&aqi=no")

if [ $? -eq 0 ]; then
  # ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช
  temperature=$(echo "$response" | jq -r '.current.temp_c') # ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ
  condition=$(echo "$response" | jq -r '.current.condition.text') # ูุตู ุงูุญุงูุฉ ุงูุฌููุฉ
  precipitation=$(echo "$response" | jq -r '.current.precip_mm') # ุงูุฃูุทุงุฑ

  # ุจูุงุก ุงููุชูุฌุฉ
  output="๏ $temperatureยฐC | ๏ฉ $condition | ๐ง $precipitation mm"

  # ุญูุธ ุงููุชูุฌุฉ ูู ููู ุงูุชุฎุฒูู ุงููุคูุช
  echo "$output" > "$CACHE_FILE"

  # ุนุฑุถ ุงููุชูุฌุฉ
  echo "$output"
else
  # ุฅุฐุง ูุดู ุงูุทูุจุ ุงุณุชุฎุฏุงู ุขุฎุฑ ุจูุงูุงุช ูุชููุฑุฉ ุฃู ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ
  if [ -f "$CACHE_FILE" ]; then
    cat "$CACHE_FILE"
  else
    echo "ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช ุงูุทูุณ"
  fi
fi